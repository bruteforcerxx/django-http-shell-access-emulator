const n=(n,t,e)=>{const o=document.createElement(n);return t&&(o.className=t),e&&(o.innerHTML=e),o},t=(n,t=!1)=>{n.input.readOnly=!t,n.inputContainer.style.opacity=t?"":"0"};var e,o;(o=e||(e={})).ON_COMMAND="onCommand",o.ON_COMMAND_NOT_FOUND="onCommand404",o.ON_PROCESS_START="onProcessStart",o.ON_PROCESS_END="onProcessStop",o.ON_PROCESS_INTERRUPT="onProcessInterrupt",o.ON_INIT="onInit";const s=(n,t,e)=>{const o=new CustomEvent(n,{detail:e});t.dispatchEvent(o)},i=(n,t)=>{const{print:o}=t,i=n.split(" "),r=i[0],a=i.slice(1),l=t.settings.commands[r];l?l.argDescriptions&&l.argDescriptions.length>0&&0===a.length?o(`Usage: ${r} ${l.argDescriptions.map((n=>`[${n}]`)).join(" ")}`):(l.func(t,...a),s(e.ON_COMMAND,t.settings.host,n)):(o(`<span class="terminal-error">command not found: ${r}</span>`),s(e.ON_COMMAND_NOT_FOUND,t.settings.host,n))},r=n=>{const{settings:{host:o}}=n;t(n),n.isProcessRunning=!0,s(e.ON_PROCESS_START,o)},a=n=>{const{input:o,settings:{host:i}}=n;t(n,!0),n.isProcessRunning=!1,o.focus(),s(e.ON_PROCESS_END,i)},l=(n,t)=>{const{history:e,lastHistoryIndex:o}=n,s=e.length-1;let i;t&&0===o||(t||o!==e.length)&&(s<0||(t?(i=o-1,n.input.value=i-1>=0?e[i-1]:""):(i=o+1,n.input.value=e[o]),n.lastHistoryIndex=i))},c=({host:t,welcomeMessage:o,prompt:c="$: ",historyLength:p=50,enableHelp:m=!0,commands:d})=>{const u={host:t,welcomeMessage:o,prompt:c,historyLength:p,enableHelp:m,commands:d};(()=>{if(0===document.head.querySelectorAll('link[data-type="terminal"]').length){const t=n("style",void 0,'.terminal{overflow-y:auto;overflow-x:hidden;background-color:var(--terminal-bg-color, black);padding:15px;box-sizing:border-box}.terminal *{color:var(--terminal-fg-color, white);font-family:var(--terminal-font, "Courier New", monospace)}.terminal-type{width:100%;display:flex}.terminal-type>span{padding-right:7pt}.terminal-type>input{flex-grow:2;background:transparent;border:0;font-size:inherit;padding:0}.terminal-type>input:focus{border:none;outline:none}.terminal-container>p{margin:0}span.terminal-command{color:var(--terminal-accent-color, #ffff7d)}span.terminal-error{color:var(--terminal-error-color, #cc1010)}');t.setAttribute("data-type","terminal"),t.setAttribute("type","text/css"),document.head.append(t)}})();const{commandContainer:g,input:h,inputContainer:y}=((t,e)=>{t.className="terminal";const o=n("div","terminal-container"),s=n("div","terminal-type"),i=n("span",void 0,e),r=n("input");return r.setAttribute("type","text"),s.append(i),s.append(r),t.append(o),t.append(s),t.addEventListener("click",(()=>r.focus())),{commandContainer:o,input:r,inputContainer:s}})(t,c),N={history:[],lastHistoryIndex:0,isProcessRunning:!1,settings:u,commandContainer:g,inputContainer:y,input:h,print:(t,e=!1)=>((t,e,o,s,i)=>{const r=n("p",void 0,e?i:t);if(e){const e=n("span","terminal-command",t);r.append(e)}o.append(r),s.scrollIntoView()})(t,e,g,h,c),run:n=>i(n,N),start:()=>r(N),stop:()=>a(N),type:(t,e=60,o)=>((t,e,o,s)=>{r(o);const i=n("p");o.commandContainer.append(i);let l=0;const c=()=>{l<t.length&&o.isProcessRunning?(i.innerHTML+=t.charAt(l),l++,setTimeout(c,e)):(s&&s(),a(o))};setTimeout(c,e)})(t,e,N,o)};return m&&(N.settings.commands.help=(n=>({name:"help",description:"shows a full list of all available commands",func:({print:t})=>{for(const e in n.settings.commands)Object.hasOwnProperty.call(n.settings.commands,e)&&t(n.settings.commands[e].name+" - "+n.settings.commands[e].description)}}))(N)),((n,t)=>{const{input:o,print:r}=t;n.addEventListener("keyup",(({key:c,ctrlKey:p})=>{if(p&&"c"===c&&t.isProcessRunning)r("^C"),a(t),s(e.ON_PROCESS_INTERRUPT,n);else{if(t.isProcessRunning)return;if("Enter"===c)return t.lastHistoryIndex=0,o.value.length>0?(r(o.value,!0),(n=>{const{input:{value:t},history:e,settings:{historyLength:o}}=n;t!==e[0]&&(e.length>=o?n.history=[t,...e.slice(0,-1)]:(n.history=[t,...e],n.lastHistoryIndex=0))})(t),i(o.value,t)):r(" ",!0),void(o.value="");if("ArrowUp"===c)return void l(t);"ArrowDown"===c&&l(t,!0)}}))})(t,N),s(e.ON_INIT,t),o&&N.print(o),N};export{c as initTerminal};
